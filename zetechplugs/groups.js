let zetechplug = async (m, { conn, reply, trashown }) => {
    try {
        // Check if user is owner
        if (!trashown) return reply("*âŒ Only owner can use this command*");

        await reply("_Fetching your groups and channels..._");

        let groupsList = "ğŸ“‹ *YOUR GROUPS & CHANNELS*\n\n";
        let groupCount = 0;
        let channelCount = 0;

        // Get all chats (groups and channels)
        const chats = await conn.getChats();
        
        for (let chat of chats) {
            if (chat.id.endsWith('@g.us')) {
                // This is a group
                groupCount++;
                const groupName = chat.name || "Unknown Group";
                const groupJid = chat.id;
                
                groupsList += `ğŸ‘¥ *Group ${groupCount}:*\n`;
                groupsList += `ğŸ“› Name: ${groupName}\n`;
                groupsList += `ğŸ†” JID: \`${groupJid}\`\n\n`;
                
            } else if (chat.id.endsWith('@newsletter')) {
                // This is a channel
                channelCount++;
                const channelName = chat.name || "Unknown Channel";
                const channelJid = chat.id;
                
                groupsList += `ğŸ“¢ *Channel ${channelCount}:*\n`;
                groupsList += `ğŸ“› Name: ${channelName}\n`;
                groupsList += `ğŸ†” JID: \`${channelJid}\`\n\n`;
            }
        }

        // Add summary
        groupsList += `ğŸ“Š *SUMMARY:*\n`;
        groupsList += `ğŸ‘¥ Groups: ${groupCount}\n`;
        groupsList += `ğŸ“¢ Channels: ${channelCount}\n`;
        groupsList += `ğŸ“± Total: ${groupCount + channelCount}\n\n`;
        groupsList += `*Generated by Zetech-MD*`;

        if (groupCount === 0 && channelCount === 0) {
            groupsList = "ğŸ“‹ *YOUR GROUPS & CHANNELS*\n\nâŒ *No groups or channels found*\n\n*You are not a member of any groups or channels.*";
        }

        await reply(groupsList);

    } catch (error) {
        console.error('[GROUPS ERROR] Error in groups command:', error);
        reply("âŒ *Failed to fetch groups and channels. Please try again later.*");
    }
};

zetechplug.help = ['groups']
zetechplug.tags = ['owner']
zetechplug.command = ['groups', 'mychats', 'listgroups']

module.exports = zetechplug;
